doctype 5
- load staticfiles
- load strings
- load variables
- load timedelta
- load cache
- load mptt_tags
- load compress
- load gravatar
- load i18n
- load dmoj_user_i18n

html(lang='en')
    head
        title
            block title
                | #{title} - #{SITE_LONG_NAME}
        meta(http-equiv='Content-Type', content='text/html; charset=UTF-8')
        if misc_config.meta_keywords
            meta(name='keywords', content=misc_config['meta_keywords'])
        meta#viewport(name='viewport', content='initial-scale=1')
        
        if og_image
            meta(property='og:image', content=og_image)
        else
            meta(property='og:image', content='//{{ site.domain }}/logo.png')
        meta(property='og:title', content='{{ title }} - {{ SITE_LONG_NAME }}')
        meta(property='og:site_name', content='{{ SITE_LONG_NAME }}')

        | <!--[if lt IE 9]>
        | <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
        | <script>window.bad_browser = true</script>
        | <![endif]-->
        block meta
        if INLINE_FONTAWESOME
            - compress css
                link(rel='stylesheet', href='{% static "style.css" %}')
                if PYGMENT_THEME
                    link(rel='stylesheet', href='{% static PYGMENT_THEME %}')
                link(rel='stylesheet', href='{% static "libs/font-awesome.css" %}')
        else
            - compress css
                link(rel='stylesheet', href='{% static "style.css" %}')
                if PYGMENT_THEME
                    link(rel='stylesheet', href='{% static PYGMENT_THEME %}')
                link(rel='stylesheet', href=FONTAWESOME_CSS)
        link(rel='canonical', href='{{ DMOJ_SCHEME }}://{{ site.domain }}{{ request.get_full_path }}')
        block media
        if INLINE_JQUERY
            - compress js
                script(src='{% static "libs/jquery-1.11.2.min.js" %}')
                script(src='{% static "common.js" %}')
                script(src='{% static "jquery.unveil.js" %}')
                script.
                    $(function () { $('img.unveil').unveil(200); });
        else
            script(src=JQUERY_JS)
            script(src='{% static "common.js" %}')
            script(src='{% static "jquery.unveil.js" %}')
            script.
                $(function () { $('img.unveil').unveil(200); });
        block js_media
        if IN_CONTEST
            script(type='text/javascript').
                $(document).ready(function () {
                    count_down($("#contest-time-remaining"));
                });

        if misc_config.analytics
            | #{misc_config.analytics|safe}
        
        if request.user.profile.user_script
            script(type='text/javascript') #{request.user.profile.user_script|safe}

        noscript
            style.
                #content {
                    margin: 80px auto auto;
                }
                
                #navigation {
                    top: 27px;
                }
    body
        nav#navigation.unselectable
            #nav-container
                a#navicon(href='javascript:void(0)')
                    i.fa.fa-bars
                    | &nbsp;{% trans "MENU" %}
                ul#nav-list
                    li.home-nav-element
                        a(href='{% url "home" %}')
                            include site_logo.svg
                    // Divider
                    li.home-nav-element
                        span(style='width: 1px; vertical-align: middle; padding-left: 3px; display: inline-block; height: 32px; margin-right: 1px; border-right: 3px solid rgba(255, 255, 255, 0.15);')
                    - recursetree nav_bar
                        li
                            a(href=node.path, class='nav-{{ node.key }} {% if node.key in nav_tab %}active{% endif %}') #{node.label|user_trans}
                            if not node.is_leaf_node
                                ul {{ children }}
                    - endrecursetree
                span#user-links(style='height: 100%')
                    if request.user.is_authenticated
                        ul(style='display: block; margin: 0')
                            li(style='display: block; height: 100%')
                                a(href='{% url "user_page" %}', style='display: block; padding: 0px; height: 100%')
                                    span
                                        img(src='{% gravatar_url request.user.email 32 %}', height='24', width='24')
                                        span
                                            - blocktrans with username=request.user.username
                                                | Hello, #[b {{ username }}].
                                ul(style='width: 150px')
                                    if request.user.is_staff or request.user.is_superuser
                                        li: a(href='{% url "admin:index" %}') {% trans "Admin" %}
                                    li: a(href='{% url "user_edit_profile" %}') {% trans "Edit profile" %}
                                    li: a(href='{% url "auth_logout" %}?next=') {% trans "Log out" %}
                    else
                        span.anon
                            a(href='{% url "django.contrib.auth.views.login" %}?next={{ LOGIN_RETURN_PATH|urlencode }}')
                                b {% trans "Login" %}
                            | &nbsp;|&nbsp;
                            a(href='/accounts/register/') {% trans "Register" %}
            #nav-shadow
        if IN_CONTEST
            #contest-info
                a(href='{% url "contest_view" CONTEST.contest.key %}', style='vertical-align: middle;')
                    | #{CONTEST.contest.name} -
                    #contest-time-remaining #{CONTEST.time_remaining | timedelta:"simple"}
        #page-container
            noscript: #noscript
                - trans "This site works best with JavaScript enabled."
            br
            div#content
                block title_row
                    h2(style='color:#393630; display:inline')
                        block content_title
                            if content_title
                                | #{content_title}
                            else
                                | #{title}
                block header
                if subtitle
                    br
                    block content_subtitle
                        h3(style='display:inline; font-size:1.5em; color:gray; font-style:italic') #{subtitle}
                block title_ruler
                    hr
                div#content-body
                    block body
            if misc_config.announcement
                div#announcement #{misc_config.announcement|safe}
            block bodyend
            footer: span#footer-content
                if misc_config.footer
                    | #{misc_config.footer|safe}
                    if perms.judge.test_site
                        = ' | '
                if perms.judge.test_site
                    form(action='{% url "set_language" %}', method='post', style='display: inline')
                        - csrf_token
                        input(name='next', type='hidden', value=request.get_full_path())
                        select(name='language', onchange='form.submit()', style='height: 1.5em')
                            - get_current_language as current_lang
                            - get_available_languages as LANGUAGES
                            - get_language_info_list for LANGUAGES as languages
                            each language in languages
                                option(value=language['code'], selected=('' if language['code'] == current_lang else None))
                                    | #{language.name_local} (#{language.code})
